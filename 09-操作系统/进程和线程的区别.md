进程和线程有什么区别？虽然大学学过，但是好气啊，大学计算机网络、组成原理狗屁没学到，玩了 4 年。没办法，欠下的债迟早都是要还的。

先看看二者定义：

## 线程和进程的定义

**进程**（Process）是计算机中的程序关于某数据集合上的一次运行活动，是系统进行资源分配和调度的基本单位，是[操作系统](https://baike.baidu.com/item/操作系统)结构的基础。

**线程**（Thread）是[操作系统](https://baike.baidu.com/item/操作系统)能够进行运算[调度](https://baike.baidu.com/item/调度)的最小单位。它被包含在[进程](https://baike.baidu.com/item/进程)之中，是[进程](https://baike.baidu.com/item/进程)中的实际运作单位。一条线程指的是[进程](https://baike.baidu.com/item/进程)中一个单一顺序的控制流，一个进程中可以并发多个线程，每条线程并行执行不同的任务。在 Unix System V 及 [SunOS] (https://baike.baidu.com/item/SunOS)中也被称为轻量进程（lightweight processes），但轻量进程更多指内核线程（kernel thread），而把用户线程（user thread）称为线程。

**线程是独立调度和分派的基本单位，一个进程可以有很多线程，每条线程并行执行不同的任务。**

> 以上内容摘自百度百科

他妈的，进程很明显解释很简短，但是线程解释就够多了。用个通俗的话来说吧，就是进程是爸爸，线程是儿子。一个爸爸能有很多儿子，一个儿子只能有一个爸爸。（好像也不太准确）

### 进程和线程的区别

- 进程是资源调度的最小单位，线程是程序执行的最小单位。
- 进程有自己独立的地址空间，每启动一个进程，系统就会为其分配地址空间，建立数据表来维护代码段，堆栈段和数据段。但是线程没有独立的空间，它们使用相同的地址空间来共享数据。
- CPU 切换一个线程比切换一个进程的开销小
- 创建一个线程比创建一个进程的开销小
- 线程占用资源比进程小很多
- 线程依赖进程存在，无法独立运行
- ... 

还有其他的暂时没有想到，想到了再补充



## 举例说明一，线程=车厢，进程=火车[^2]

- 线程在进程下行进（单列车厢无法行进）
- 一个进程可以包含多个线程（一列或者可能有多个车厢）
- 不同进程间的数据很难共享（一辆火车上的乘客很难换到另一辆火车上去，比如站点换乘）
- 同一进程下的不同线程数据很容易共享（A 车厢到 B 车厢很容易）
- 进程要比线程消耗更多的资源（采用多列火车相比多个车厢更耗资源）
- 进程间不会相互影响，一个线程挂掉将导致整个进程挂掉（一列火车不会影响到另外一列火车，但是如果一列火车上中间的一节车厢着火了，将影响到所有车厢）
- 进程可以拓展到多机，进程最多适合多核（不同火车可以开在多个轨道上，同一火车的车厢不能在行进的不同的轨道上）
- 进程使用的内存地址可以上锁，即一个线程使用某些共享内存时，其他线程必须等它结束，才能使用这一块内存（比如火车上的洗手间）－"互斥锁"
- 进程使用的内存地址可以限定使用量（比如火车上的餐厅，最多只允许多少人进入，如果满了需要在门口等，等有人出来了才能进去）－“信号量”



## 举例说明二，线程=工人，进程=工厂[^1]

计算机的核心是 CPU，它承担了所有的计算任务。它就像一座工厂，时刻在运转。

假定工厂的电力有限，一次只能供一个车间使用。也就是说当一个车间开工的时候，其他车间都必须停工。其背后的含义就是单个 CPU 只能运行一个任务

进程就好比工厂的车间，它代表 CPU 所能处理的单个任务。任一时刻，CPU 总是运行一个进程，其他进程处于非运行状态。



一个车间里，可能有许多工人。他们协同完成一个任务。

线程就好比车间里的工人，一个进程可以包括多个线程。



车间里面的工人是共享的，比如许多房间是每个工人都可以进去的。这意味着一个进程的内存空间是共享的，每个线程都可以使用这些内存。



可是每个房间的大小不一样，有些房间最多只能容纳一个人，比如厕所。里面有人的时候，其他人就不能进去了。这代表这一个线程使用某一块共享内存时，其他线程必须得等他结束，它才能使用这块共享内存。



一个防止他人进入的简单方法，就是在门口加一把锁。先到的人锁上门（临界区），后面来的人看到门上上了锁，就只能排队等候，等锁打开后再进入，这就叫互斥锁。以防止多个线程同时读写某一块共享内存。



还有一些房间可以同时容纳 n 个人，比如厨房。也就是说当人数大于 n 时，多出来的人只能在外面等着。这就好比某些内存区域只能给固定数目的线程使用。



这时解决的方法就是在门口挂 n 把钥匙，进去的人就取一把钥匙，出来时再把钥匙还回去。后面到的人发现钥匙空了，就知道里面的人满了，必须在门口排队等着。这种做法就叫做信号量（Semaphore），用来保证多个线程不会相互冲突。



不难看出，mutex 是 Semaphore 的一种特殊情况（n=1）。也就是说后者完全可以替代前者，但是因为 mutex 较为简单，且效率高，所以在保证资源必须独占的情况下，还是使用这种方式。

操作系统的设计，因此可以归结为三点：

1. 以多进程形式，允许多个任务同时运行；
2. 以多线程形式，允许单个任务分成不同的部分运行；
3. 提供协调机制，一方面防止进程之间和线程之间产生冲突，另一方面允许进程之间和线程之间共享资源。



[^1]:[阮一峰的博客](http://www.ruanyifeng.com/blog/2013/04/processes_and_threads.html)
[^2]:[参考知乎解释](https://www.zhihu.com/question/25532384)

